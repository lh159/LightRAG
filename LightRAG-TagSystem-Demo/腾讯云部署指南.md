# LightRAGæ ‡ç­¾ç³»ç»Ÿ - è…¾è®¯äº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ðŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. è¿žæŽ¥æœåŠ¡å™¨
```bash
# ä½¿ç”¨SSHè¿žæŽ¥æ‚¨çš„è…¾è®¯äº‘æœåŠ¡å™¨
ssh root@æ‚¨çš„æœåŠ¡å™¨IP
```

### 2. ä¸‹è½½éƒ¨ç½²è„šæœ¬
```bash
# ä¸‹è½½éƒ¨ç½²è„šæœ¬
wget https://raw.githubusercontent.com/lh159/LightRAG/main/deploy_tencent_cloud.sh

# æˆ–è€…ç›´æŽ¥å…‹éš†æ•´ä¸ªé¡¹ç›®
git clone https://github.com/lh159/LightRAG.git
cd LightRAG
```

### 3. æ‰§è¡Œéƒ¨ç½²
```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy_tencent_cloud.sh

# æ‰§è¡Œéƒ¨ç½²è„šæœ¬
bash deploy_tencent_cloud.sh
```

## ðŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### æœåŠ¡å™¨è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 18.04+ / CentOS 7+
- **å†…å­˜**: è‡³å°‘2GB RAM
- **å­˜å‚¨**: è‡³å°‘10GBå¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: å¼€æ”¾80ç«¯å£ï¼ˆHTTPï¼‰

### è…¾è®¯äº‘é…ç½®
1. **å®‰å…¨ç»„è®¾ç½®**:
   - å¼€æ”¾22ç«¯å£ï¼ˆSSHï¼‰
   - å¼€æ”¾80ç«¯å£ï¼ˆHTTPï¼‰
   - å¼€æ”¾443ç«¯å£ï¼ˆHTTPSï¼Œå¯é€‰ï¼‰

2. **åŸŸåè§£æž**ï¼ˆå¯é€‰ï¼‰:
   - å°†åŸŸåè§£æžåˆ°æœåŠ¡å™¨IP
   - é…ç½®SSLè¯ä¹¦

## ðŸ”§ æ‰‹åŠ¨éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1: æ›´æ–°ç³»ç»Ÿ
```bash
sudo apt-get update
sudo apt-get upgrade -y
```

### æ­¥éª¤2: å®‰è£…åŸºç¡€ä¾èµ–
```bash
sudo apt-get install -y python3 python3-pip python3-venv git curl wget nginx supervisor
```

### æ­¥éª¤3: åˆ›å»ºé¡¹ç›®ç›®å½•
```bash
sudo mkdir -p /opt/lightrag
sudo chown $USER:$USER /opt/lightrag
cd /opt/lightrag
```

### æ­¥éª¤4: å…‹éš†ä»£ç 
```bash
git clone https://github.com/lh159/LightRAG.git .
```

### æ­¥éª¤5: åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒ
```bash
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
```

### æ­¥éª¤6: é…ç½®çŽ¯å¢ƒå˜é‡
```bash
cat > .env << EOF
FLASK_ENV=production
FLASK_APP=web.app
OPENAI_API_KEY=sk-2e4c8701d3e048b794939a432ab956ab
DEEPSEEK_API_KEY=sk-2e4c8701d3e048b794939a432ab956ab
EOF
```

### æ­¥éª¤7: åˆå§‹åŒ–æ•°æ®åº“
```bash
source venv/bin/activate
python3 -c "
from app.utils.database import DatabaseManager
db_manager = DatabaseManager()
print('æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ')
"
```

### æ­¥éª¤8: åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
```bash
python3 -c "
from app.utils.database import DatabaseManager
db_manager = DatabaseManager()
result = db_manager.create_user('admin', 'admin123', 'admin@lightrag.com')
if result['success']:
    print('ç®¡ç†å‘˜ç”¨æˆ·åˆ›å»ºæˆåŠŸ')
    print('ç”¨æˆ·å: admin')
    print('å¯†ç : admin123')
else:
    print('ç®¡ç†å‘˜ç”¨æˆ·åˆ›å»ºå¤±è´¥:', result['error'])
"
```

### æ­¥éª¤9: é…ç½®Nginx
```bash
sudo tee /etc/nginx/sites-available/lightrag << EOF
server {
    listen 80;
    server_name _;
    
    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
    }
    
    location /static {
        alias /opt/lightrag/web/static;
        expires 30d;
    }
}
EOF

sudo ln -sf /etc/nginx/sites-available/lightrag /etc/nginx/sites-enabled/
sudo rm -f /etc/nginx/sites-enabled/default
sudo nginx -t
sudo systemctl restart nginx
sudo systemctl enable nginx
```

### æ­¥éª¤10: é…ç½®Supervisor
```bash
sudo tee /etc/supervisor/conf.d/lightrag.conf << EOF
[program:lightrag]
command=/opt/lightrag/venv/bin/python /opt/lightrag/run_demo.py
directory=/opt/lightrag
user=$USER
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/opt/lightrag/logs/lightrag.log
environment=FLASK_ENV="production"
EOF

sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start lightrag
```

### æ­¥éª¤11: é…ç½®é˜²ç«å¢™
```bash
sudo ufw allow 22
sudo ufw allow 80
sudo ufw allow 443
sudo ufw --force enable
```

## ðŸŽ‰ éƒ¨ç½²å®Œæˆ

### è®¿é—®åº”ç”¨
- **è®¿é—®åœ°å€**: `http://æ‚¨çš„æœåŠ¡å™¨IP`
- **ç®¡ç†å‘˜è´¦æˆ·**: `admin` / `admin123`

### ç®¡ç†å‘½ä»¤
```bash
# å¯åŠ¨æœåŠ¡
sudo supervisorctl start lightrag

# åœæ­¢æœåŠ¡
sudo supervisorctl stop lightrag

# é‡å¯æœåŠ¡
sudo supervisorctl restart lightrag

# æŸ¥çœ‹çŠ¶æ€
sudo supervisorctl status lightrag

# æŸ¥çœ‹æ—¥å¿—
sudo supervisorctl tail lightrag
```

## ðŸ”’ å®‰å…¨é…ç½®

### 1. ä¿®æ”¹é»˜è®¤å¯†ç 
```bash
# ç™»å½•åº”ç”¨åŽç«‹å³ä¿®æ”¹ç®¡ç†å‘˜å¯†ç 
# æˆ–è€…é€šè¿‡æ•°æ®åº“ç›´æŽ¥ä¿®æ”¹
```

### 2. é…ç½®SSLè¯ä¹¦ï¼ˆæŽ¨èï¼‰
```bash
# å®‰è£…Certbot
sudo apt-get install certbot python3-certbot-nginx

# èŽ·å–SSLè¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ : 0 12 * * * /usr/bin/certbot renew --quiet
```

### 3. å®šæœŸå¤‡ä»½
```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > /opt/lightrag/backup.sh << EOF
#!/bin/bash
BACKUP_DIR="/opt/backups/lightrag"
DATE=\$(date +%Y%m%d_%H%M%S)
mkdir -p \$BACKUP_DIR
tar -czf \$BACKUP_DIR/lightrag_\$DATE.tar.gz /opt/lightrag
echo "å¤‡ä»½å®Œæˆ: \$BACKUP_DIR/lightrag_\$DATE.tar.gz"
EOF

chmod +x /opt/lightrag/backup.sh

# æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡
sudo crontab -e
# æ·»åŠ : 0 2 * * * /opt/lightrag/backup.sh
```

## ðŸ› æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡æ— æ³•å¯åŠ¨**
   ```bash
   # æ£€æŸ¥æ—¥å¿—
   sudo supervisorctl tail lightrag
   
   # æ£€æŸ¥ç«¯å£å ç”¨
   sudo netstat -tlnp | grep :5000
   ```

2. **Nginxé…ç½®é”™è¯¯**
   ```bash
   # æµ‹è¯•é…ç½®
   sudo nginx -t
   
   # é‡å¯Nginx
   sudo systemctl restart nginx
   ```

3. **æ•°æ®åº“è¿žæŽ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
   ls -la /opt/lightrag/database/
   
   # é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
   cd /opt/lightrag
   source venv/bin/activate
   python3 -c "from app.utils.database import DatabaseManager; DatabaseManager()"
   ```

4. **API Keyé”™è¯¯**
   ```bash
   # æ£€æŸ¥çŽ¯å¢ƒå˜é‡
   cat /opt/lightrag/.env
   
   # æ›´æ–°API Key
   nano /opt/lightrag/.env
   ```

### æ—¥å¿—ä½ç½®
- **åº”ç”¨æ—¥å¿—**: `/opt/lightrag/logs/lightrag.log`
- **Nginxæ—¥å¿—**: `/var/log/nginx/`
- **ç³»ç»Ÿæ—¥å¿—**: `/var/log/syslog`

## ðŸ“ž æŠ€æœ¯æ”¯æŒ

å¦‚æžœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹ç›¸å…³æ—¥å¿—æ–‡ä»¶
2. æ£€æŸ¥é…ç½®æ–‡ä»¶
3. ç¡®è®¤ç½‘ç»œè¿žæŽ¥
4. è”ç³»æŠ€æœ¯æ”¯æŒ

---

**æ³¨æ„**: è¯·ç¡®ä¿åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ä¿®æ”¹é»˜è®¤å¯†ç å’ŒAPIå¯†é’¥ï¼ 